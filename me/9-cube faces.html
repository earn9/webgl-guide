<canvas id="canvas" width=400 height=400></canvas>
<script src="../me/webgl.js"></script>
<script src="../me/matrix.js"></script>
<script>

// Convert deg in radians
deg2rad = angle => Math.PI * angle / 180;

// WebGL canvas context
var gl = canvas.getContext("webgl");

// Vertex shader
var vshader = `
attribute vec4 pos;
attribute vec4 col;
uniform mat4 camera;
varying vec4 v_col;
void main() {

  // Apply the camera matrix to the vertex position
  gl_Position = camera * pos;
  
  // Set the varying color
  v_col = col;
}`;

// Fragment shader
var fshader = `
precision mediump float;
varying vec4 v_col;
void main() {
  gl_FragColor = v_col;
}`;

// Compile program
var program = compile(gl, vshader, fshader);

// Create a cube
var vertices = new Float32Array([  // Vertex coordinates
   1.0, 1.0, 1.0,  -1.0, 1.0, 1.0,  -1.0,-1.0, 1.0,   1.0,-1.0, 1.0, // front
   1.0, 1.0, 1.0,   1.0,-1.0, 1.0,   1.0,-1.0,-1.0,   1.0, 1.0,-1.0, // right
   1.0, 1.0, 1.0,   1.0, 1.0,-1.0,  -1.0, 1.0,-1.0,  -1.0, 1.0, 1.0, // up
  -1.0, 1.0, 1.0,  -1.0, 1.0,-1.0,  -1.0,-1.0,-1.0,  -1.0,-1.0, 1.0, // left
  -1.0,-1.0,-1.0,   1.0,-1.0,-1.0,   1.0,-1.0, 1.0,  -1.0,-1.0, 1.0, // down
   1.0,-1.0,-1.0,  -1.0,-1.0,-1.0,  -1.0, 1.0,-1.0,   1.0, 1.0,-1.0  // back
]);

var colors = new Float32Array([  // Colors
  0.4, 0.4, 1.0,  0.4, 0.4, 1.0,  0.4, 0.4, 1.0,  0.4, 0.4, 1.0, // front (purple)
  0.4, 1.0, 0.4,  0.4, 1.0, 0.4,  0.4, 1.0, 0.4,  0.4, 1.0, 0.4, // right (green)
  1.0, 0.4, 0.4,  1.0, 0.4, 0.4,  1.0, 0.4, 0.4,  1.0, 0.4, 0.4, // up    (red)
  1.0, 1.0, 0.4,  1.0, 1.0, 0.4,  1.0, 1.0, 0.4,  1.0, 1.0, 0.4, // left  (yellow)
  1.0, 1.0, 1.0,  1.0, 1.0, 1.0,  1.0, 1.0, 1.0,  1.0, 1.0, 1.0, // down  (white)
  0.4, 1.0, 1.0,  0.4, 1.0, 1.0,  0.4, 1.0, 1.0,  0.4, 1.0, 1.0  // back  (blue)
]);

var indices = new Uint8Array([  // Indices
  0, 1, 2,   0, 2, 3,  // front
  4, 5, 6,   4, 6, 7,  // right
  8, 9, 10,  8, 10,11, // up
  12,13,14,  12,14,15, // left
  16,17,18,  16,18,19, // down
  20,21,22,  20,22,23  // back
]);

var n = 36;

// Set position and color
arraybuffer(gl, vertices, program, 'pos', 3, gl.FLOAT);
arraybuffer(gl, colors, program, 'col', 3, gl.FLOAT);

// Set indices
var indexBuffer = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW);

// Set the clear color and enable the depth test
gl.clearColor(0.0, 0.0, 0.0, 1.0);
gl.enable(gl.DEPTH_TEST);

// Set the camera
var camera = gl.getUniformLocation(program, 'camera');
var cameraMatrix = perspective({fovy: deg2rad(30), aspect: 1, near: 1, far: 100});
cameraMatrix = transform(cameraMatrix, {z: -5});
gl.uniformMatrix4fv(camera, false, cameraMatrix);

// Animate
setInterval(() => {
  cameraMatrix = transform(cameraMatrix, {rx: .01, ry: .02, rz: .01});
  gl.uniformMatrix4fv(camera, false, cameraMatrix);
  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
  gl.drawElements(gl.TRIANGLES, n, gl.UNSIGNED_BYTE, 0);
}, 16);
</script>